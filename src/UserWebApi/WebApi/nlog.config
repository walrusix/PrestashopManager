<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      >

  <extensions>
    <add assembly="NLog.Web.AspNetCore"/>
    <add assembly="System.Data.SqlClient" />
  </extensions>

  <!--<variable name="DefaultLayout" value="${longdate} | ${event-properties:item=EventId_Id} | ${level:uppercase=true:padding=5} | ${logger} | ${message} | ${exception:format=type,tostring} | ${callsite} | url: ${aspnet-request-url} | action: ${aspnet-mvc-action}" />-->

  <!-- the targets to write to -->
  <targets async="true">
    

    <!--<target xsi:type="ColoredConsole" name="ColorConsole" layout="${DefaultLayout}" />-->
    <target xsi:type="ColoredConsole" name="ColorConsole" layout="${longdate} | ${level} | ${exception:format=type} : ${message} | ${callsite}"/>

    <target name="Database" xsi:type="Database" keepConnection="true"
                 dbProvider="System.Data.SqlClient"
      connectionString="Data Source=.;Initial Catalog=PrestashopManagerLogDb;Integrated Security=true"
      commandText="INSERT INTO Logs(EventDateTime, EventLevel, UserName, MachineName, EventMessage,ErrorType, ErrorSource,ErrorNamespace, ErrorClass, ErrorMethod, ErrorMessage, InnerErrorMessage, AssemblyName,Controller,Action,LanguageHeader) VALUES (@EventDateTime, @EventLevel, @UserName, @MachineName, @EventMessage,@ErrorType, @ErrorSource,@ErrorNamespace, @ErrorClass, @ErrorMethod, @ErrorMessage, @InnerErrorMessage, @AssemblyName, @Controller, @Action, @LanguageHeader)">
      <!-- parameters for the command -->
      <parameter name="@EventDateTime" layout="${date}" />
      <parameter name="@EventLevel" layout="${level}" />
      <parameter name="@UserName" layout="${aspnet-user-identity}" />
      <parameter name="@MachineName" layout="${machinename}" />
      <parameter name="@EventMessage" layout="${message}" />
      <parameter name="@ErrorSource" layout="${event-context:item=error-source}" />
      <parameter name="@ErrorNamespace" layout="${callsite:className=false:includeSourcePath=true:IncludeNamespace=true:methodName=false}" />
      <parameter name="@ErrorClass" layout="${callsite:className=true:includeSourcePath=false:IncludeNamespace=false:methodName=false}" />
      <parameter name="@ErrorMethod" layout="${callsite:className=false:includeSourcePath=false:methodName=true}" />
      <parameter name="@Controller" layout="${aspnet-mvc-controller}" />
      <parameter name="@Action" layout="${aspnet-mvc-action}" />
      <parameter name="@ErrorType" layout="${exception:format=ShortType}" />
      <parameter name="@ErrorMessage" layout="--" />
      <parameter name="@InnerErrorMessage" layout="${event-context:item=inner-error-message}" />
      <parameter name="@AssemblyName" layout="${var:AssemblyName}" />
      <parameter name="@LanguageHeader" layout="--" />
    </target>
    
  </targets>

  <!-- rules to map from logger name to target -->
  <rules>
    <logger name="*" minlevel="Info" writeTo="ColorConsole" />
    <logger name="*" minlevel="Info" writeTo="Database" />
  </rules>
</nlog>